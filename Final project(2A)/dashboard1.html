<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Dashboard
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
  </style>
 </head>
 <body class="bg-white">
  <header class="flex items-center justify-between border-b border-gray-300 px-4 sm:px-6 md:px-8 h-14">
   <div class="flex items-center space-x-4">
    <button aria-label="Menu" class="text-gray-700 focus:outline-none">
     <i class="fas fa-bars text-lg">
     </i>
    </button>
    <span class="font-extrabold text-black text-sm select-none">
     DASHBOARD
    </span>
   </div>
   <div class="flex items-center space-x-6 text-gray-700">
    <button aria-label="User Profile" class="text-lg focus:outline-none">
     <i class="fas fa-user">
     </i>
    </button>
    <button aria-label="Logout" class="text-lg focus:outline-none">
     <i class="fas fa-sign-out-alt">
     </i>
    </button>
   </div>
  </header>
  <main class="flex flex-col md:flex-row gap-4 p-4 md:p-8 max-w-[1200px] mx-auto">
   
   <section class="bg-white rounded-xl shadow-md p-6 w-full md:w-1/2 max-w-full md:max-w-[600px] flex flex-col gap-6">
    <div>
     <label for="associationDropdown" class="block text-xs font-semibold text-gray-700 mb-1">Association Name</label>
     <select id="associationDropdown" class="w-full border border-gray-300 rounded px-3 py-2 text-xs font-normal text-gray-900">
      <option value="">Select Association</option>
     </select>
    </div>
    
    <div class="w-full overflow-x-auto">
     <canvas id="screenTimeChart" class="w-full max-w-full h-auto rounded" height="200"></canvas>
    </div>
    
    <div class="flex flex-col md:flex-row gap-6">
     
     <div class="flex flex-col gap-2 w-full md:w-1/3">
      <div class="flex justify-between items-center border border-gray-200 rounded px-3 py-2 text-xs font-semibold text-gray-700">
       <span>
        Associations:
       </span>
       <span>
        15
       </span>
      </div>
      <div class="flex justify-between items-center border border-gray-200 rounded px-3 py-2 text-xs font-semibold text-gray-700">
       <span>
        Drivers:
       </span>
       <span>
        134
       </span>
      </div>
      <div class="flex justify-between items-center border border-gray-200 rounded px-3 py-2 text-xs font-semibold text-gray-700">
       <span>
        Users:
       </span>
       <span>
        540
       </span>
      </div>
      <div class="flex justify-between items-center border border-gray-200 rounded px-3 py-2 text-xs font-semibold text-gray-700">
       <span>
        Dispatcher:
       </span>
       <span>
        15
       </span>
      </div>
      <div class="flex justify-start items-center text-xs font-semibold">
       <span>
        Active Drivers:
       </span>
       <span class="ml-1 text-green-600">
        130
       </span>
       <span>
        /134
       </span>
      </div>
     </div>
     
     <div class="flex flex-col gap-3 w-full md:w-2/3">
      <h3 class="text-xs font-bold text-gray-700 mb-1">
       Most Visited Places
      </h3>
      <div class="flex items-center gap-3">
       <img alt="Small image of QMSC - Mamburao Campus showing a building and greenery" class="w-10 h-10 rounded" draggable="false" height="40" src="https://storage.googleapis.com/a1aa/image/3542c3bb-c4d4-4ad1-ebf5-f1bca6f79790.jpg" width="40"/>
       <div class="flex-1 text-xs font-semibold text-gray-700">
        QMSC - Mamburao Campus
       </div>
       <div class="flex-1 h-2 rounded-full bg-gray-200 relative overflow-hidden">
        <div class="absolute top-0 left-0 h-2 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500" style="width: 74%;">
        </div>
       </div>
       <div class="w-10 text-right text-xs font-semibold text-gray-700">
        74%
       </div>
      </div>
      <div class="flex items-center gap-3">
       <img alt="Small image of OMNHS showing a building with trees" class="w-10 h-10 rounded" draggable="false" height="40" src="https://storage.googleapis.com/a1aa/image/050a652d-8f33-491b-40b0-c2c65b08f908.jpg" width="40"/>
       <div class="flex-1 text-xs font-semibold text-gray-700">
        OMNHS
       </div>
       <div class="flex-1 h-2 rounded-full bg-gray-200 relative overflow-hidden">
        <div class="absolute top-0 left-0 h-2 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500" style="width: 52%;">
        </div>
       </div>
       <div class="w-10 text-right text-xs font-semibold text-gray-700">
        52%
       </div>
      </div>
      <div class="flex items-center gap-3">
       <img alt="Small image of Provincial Hospital showing a building with blue sky" class="w-10 h-10 rounded" draggable="false" height="40" src="https://storage.googleapis.com/a1aa/image/9aa77b4e-a9b7-4d86-eabd-e9eeae158cf8.jpg" width="40"/>
       <div class="flex-1 text-xs font-semibold text-gray-700">
        Provincial Hospital
       </div>
       <div class="flex-1 h-2 rounded-full bg-gray-200 relative overflow-hidden">
        <div class="absolute top-0 left-0 h-2 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500" style="width: 30%;">
        </div>
       </div>
       <div class="w-10 text-right text-xs font-semibold text-gray-700">
        30%
       </div>
      </div>
     </div>
    </div>
   </section>
   
   <section class="w-full md:w-1/2 max-w-full md:max-w-[600px] rounded-xl overflow-hidden shadow-md">
    <img alt="Google satellite map showing Mamburao Municipal Hall area with roads, buildings, and coastline" class="w-full h-auto object-cover" draggable="false" height="400" src="https://storage.googleapis.com/a1aa/image/394c3b58-13b1-42f3-77f1-23e443b5c208.jpg" width="600"/>
   </section>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const associationDropdown = document.getElementById('associationDropdown');
      const ctx = document.getElementById('screenTimeChart').getContext('2d');
      let screenTimeChart;

      // Fetch associations from backend
      fetch('view/get_associations.php')
        .then(response => response.json())
        .then(data => {
          data.forEach(assoc => {
            const option = document.createElement('option');
            option.value = assoc.id;
            option.textContent = assoc.name;
            associationDropdown.appendChild(option);
          });
        });

      // Fetch and render chart data for selected association
      associationDropdown.addEventListener('change', function () {
        const assocId = this.value;
        if (!assocId) {
          if (screenTimeChart) {
            screenTimeChart.destroy();
          }
          return;
        }
        fetch(`view/get_screen_time.php?association_id=${assocId}`)
          .then(response => response.json())
          .then(data => {
            const labels = data.map(item => item.toda_name);
            const screenTimes = data.map(item => item.screen_time);

            if (screenTimeChart) {
              screenTimeChart.destroy();
            }

            screenTimeChart = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Screen Time (minutes)',
                  data: screenTimes,
                  backgroundColor: 'rgba(54, 162, 235, 0.7)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1
                }]
              },
              options: {
                scales: {
                  y: {
                    beginAtZero: true
                  }
                }
              }
            });
          });
      });
    });
  </script>
 </body>
</html>
